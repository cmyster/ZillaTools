Better structure.
Code needs to be more general.
Drop the globals in favor of better return from threads.
