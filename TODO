Better structure.
Code in functions.py needs to be more general.
Drop the globals in favor of better return from threads.
